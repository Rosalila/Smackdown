<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>

<p id="notice"><%= notice %></p>

<section class="content-header">
  <h1>
    <%= @community.name %>
    <small><%=t('you_are_visiting_a_community')%></small>
  </h1>
</section>
<div class="box">
  <div class="box-body">
    <div class="row">
      <div class="col-md-12" align="center">
        <div class="box box-primary">
          <img src="<%= @community.main_image %>"/>
        </div>
      </div>
      <div class="col-md-3" align="center">
        <div class="box box-primary">
          <p>
            <strong><%=t('About')%>:</strong>
            <%= @community.description %>
          </p>
        </div>
      </div>
      <div class="col-md-9" align="center">
        <div class="box box-primary">
          <%@community.users.each do |user|%>
            <a href="/smackdown_creator/select_game?user_id=<%=user.id%>">
              <img height="90" src='http://graph.facebook.com/<%= user.uid %>/picture?type=normal'/>
            </a>
          <%end%>
          <div class="box-footer">
            <a href="/communities/manage_users?community_id=<%=@community.id%>">
              <button type="submit" class="btn btn-primary"><%=t('Manage_users')%></button>
            </a>
          </div>
        </div>
      </div>
      <div class="col-md-12" align="center">
        <div class="box box-primary">
          <div style='width: 800px;'>
            <div id="map" style='width: 800px; height: 400px;'></div>
          </div>
        </div>
      </div>
      <div class="col-md-12" align="center">
        <div class="box box-primary">
           <a href="/communities/<%=@community.id%>/edit">
            <button type="submit" class="btn btn-primary"><%=t('Edit')%></button>
           </a>
        </div>
      </div>
    </div>
  </div>
</div>

<%Game.all.each do |game|%>

<img class="resizable_image" src="<%= game.image_path.split('.')[0] %>_100.png"/>
<h2>Racha</h2>
    <% streakGlobalByGameList(game.id).each do |streak|%>
      <div class="row">
        <div class="col-md-6 col-sm-6 col-xs-12">
          <div class="info-box">
            <span class="info-box-icon bg-green"><i class="fa fa-angle-double-up"></i></span>
            <div class="info-box-content">
              <table>
                <tr>
                  <td>
                    <img height="90" src='http://graph.facebook.com/<%= streak[0].uid %>/picture?type=normal'/>
                  </td>
                  <td>
                    <span class="info-box-text">Racha</span>
                    <span class="info-box-number"><%= streak[1] %></span>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    <%end%>

<br/>
<br/>
<h2>Diferencia</h2>

    <% differenceGlobalByGameList(game.id).each do |diff|%>
      <% if diff[2]>0 %>
        <div class="row">
          <div class="col-md-6 col-sm-6 col-xs-12">
            <div class="info-box">
              <span class="info-box-icon bg-green"><i class="fa fa-angle-double-up"></i></span>
              <div class="info-box-content">
                <table>
                  <tr>
                    <td>
                      <img height="90" src='http://graph.facebook.com/<%= diff[0].uid %>/picture?type=normal'/>
                    </td>
                    <td>
                      <% if diff[1]>0 %>
                        <span class="info-box-text" style="color: green">Diferencia: <b>+<%= diff[1] %></b></span>
                      <% elsif diff[1]<0 %>
                        <span class="info-box-text" style="color: red">Diferencia: <b><%= diff[1] %></b></span>
                      <% else %>
                        <span class="info-box-text">Diferencia: <b><%= diff[1] %></b></span>
                      <% end %>
                      <span class="info-box-text">Smackdowns jugados: <b><%= diff[2] %></b></span>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      <%end%>
    <%end%>
<%end%>

<script type="text/javascript">
  var polygons;
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    polygons = handler.addPolygons(
    [
      [
        <%@community.community_points.each do |point|%>
          {lat: <%=point.latitude%>, lng: <%=point.longitude%>},
        <%end%>
      ],
    ],
    { strokeColor: '#FF0000'}
    );
  });
</script>
