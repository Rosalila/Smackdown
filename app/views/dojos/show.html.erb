<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>

<section class="content-header">
  <h1>
    <%= @dojo.name %> "<%= @dojo.motto %>"<img src="<%= @dojo.badge_image %>"/>
    <small>tú estás visitando un dojo</small>
  </h1>
</section>

<div class="box">
  <div class="box-body">
    <div class="row">
      <div class="col-md-12" align="center">
        <div class="box box-primary">
          <img src="<%= @dojo.main_image %>"/>
        </div>
      </div>

      <div class="col-md-3" align="center">
        <div class="box box-primary">
          <p>
            <strong>Descripción:</strong>
            <%= @dojo.about %>
          </p>
          <p>
            <strong>Horario:</strong>
            <%= @dojo.schedule %>
          </p>
          <p>
            <strong>Dirección:</strong>
            <%= @dojo.public_address %>
          </p>
        </div>
      </div>
      <div class="col-md-9" align="center">
        <div class="box box-primary">
          <table>
            <tr>
              <td>
                <p>a<p>
              </td>
              <td>
                <p>a<p>
              </td>
            </tr>
            <tr>
              <td>
                <a href="/dojos/<%=@dojo.id%>/edit">
                  <button type="submit" class="btn btn-primary">Enviar smackdown!</button>
                </a>
              </td>
              <td>
                <a href="/dojos/<%=@dojo.id%>/edit">
                  <button type="submit" class="btn btn-primary">Enviar smackdown!</button>
                </a>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="col-md-12" align="center">
        <div class="box box-primary">
          <div style='width: 800px;'>
            <div id="map" style='width: 800px; height: 400px;'></div>
          </div>
        </div>
      </div>
      <div class="col-md-12" align="center">
        <div class="box box-primary">
           <a href="/dojos/<%=@dojo.id%>/edit">
            <button type="submit" class="btn btn-primary">Editar</button>
           </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers([
    <% Dojo.all.each do |dojo| %>
      {
        "lat": <%= dojo.latitude %>,
        "lng": <%= dojo.longitude %>,
        "picture": {
          "url": "<%=dojo.badge_image%>",
          "width":  36,
          "height": 36
        },
        "infowindow": "<%=dojo.motto%> <a href='/dojos/<%=dojo.id%>'>Visit</a>"
      },
    <%end%>
    ]);
    handler.map.serviceObject.setCenter(new google.maps.LatLng(<%= @dojo.latitude %>, <%= @dojo.longitude %>));
  });
</script>
