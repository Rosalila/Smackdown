<section class="content-header">
  <h1>
    <%= t('Explore') %>
    <small><%= t('find_opponents_all_around_the_world') %></small>
  </h1>
</section>

<div class="box">
  <div class="row">
    <div class="col-md-7">
      <form role="form" accept-charset="UTF-8" action="/home/explore" method="get" class="nifty_form">
        <div class="input-group input-group-sm">
          <input name="like_param" placeholder="Escribe el nombre del usuario aqui." type="text" class="form-control">
          <span class="input-group-btn">
            <button class="btn btn-info btn-flat" type="submit">Buscar!</button>
          </span>
        </div>
      </form>
      <div class="box-body">
        <table id="example1" class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>Imagen</th>
              <th>Nombre</th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
                <tr>
                  <td>
                    <a href="/home/visit/<%= user.id %>">
                      <img class="resizable_image" src="http://graph.facebook.com/<%= user.uid %>/picture?type=large"/>
                    </a>
                  </td>
                  <td>
                    <a href="/home/visit/<%= user.id %>"><%= user.name%></a>
                    <%if current_user %>
                      <a href="/home/users?like_param=<%=@like_param%>&favorite_id=<%=user.id%>">
                        <% if Favorite.where(user: current_user, favorited_id: user.id).count>0 %>
                          <i style="color: #e74c3c" class="fa fa-heart"></i>
                        <% else %>
                          <i style="color: #e74c3c" class="fa fa-heart-o"></i>
                        <% end %>
                      </a>
                    <%end %>
                  </td>
                </tr>
            <% end %>
          </tbody>
          <tfoot>
            <tr>
              <th>Imagen</th>
              <th>Nombre</th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="col-md-5" align="center">
       <table>
       <% Smackdown.find(:all, :order => "created_at desc", :limit => 5).reverse.each do |smackdown| %>
         <tr>
         <td>
         <%= render '/home/smackdown_header_small', :locals => {:smackdown=> smackdown} %>
         </td>
         </tr>
       <% end %>
       </table>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      <script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
      <script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>

      <div style='width: 800px;'>
        <div id="map" style='width: 800px; height: 400px;'></div>
      </div>
      <script type="text/javascript">
        handler = Gmaps.build('Google');
        handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
          markers = handler.addMarkers([
          <% Dojo.all.each do |dojo| %>
          {
              "lat": <%=dojo.latitude%>,
              "lng": <%=dojo.longitude%>,
              "picture": {
                "url": "<%=dojo.badge_image%>",
                "width":  36,
                "height": 36
              },
              "infowindow": "<%=dojo.motto%> <a href='/dojos/<%=dojo.id%>'>Visit</a>"
            },
          <%end%>
          ]);
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
        });
      </script>
              <a href="/dojos/new">
                <button type="submit" class="btn btn-primary">Registra tu dojo!</button>
              </a>
    </div>
  </div><!-- /.box-body -->
</div><!-- /.box -->
